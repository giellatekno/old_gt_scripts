#!/bin/bash
#
# Shell script for exporting divvun.no www-pages from cvs 
# to the official www-directory
# Only the xml-files with tag "release" are exported.
# The command for tagging the release:    cvs tag release files...
#
# To get cvs ssh working without password prompting:
# ssh-keygen -t rsa
# <just type enter to all questions>
# chmod 0644 .ssh/id_rsa.pub
# scp id_rsa.pub <user>@cochise.uit.no:.ssh/authorized_keys2


#export CVS_RSH=ssh
checkout()
{
    # Module name what we want to publish
    MODULE="xtdoc/sd/src/documentation"
    DOCMODULE="gt/doc"
    REPOSITORY=":ext:cochise.uit.no:/usr/local/cvs/repository"
    TEMPDIR="toserver"
    TEMPDOC="doc"
    echo $TEMPDOC
    cd $HOME

    if  ! [ -d $TEMPDIR ]; then
         mkdir $TEMPDIR
    fi

     # Release we want to publish
    #RELEASE="DIVVUN-NO_1_0_RELEASE"
    RELEASE="HEAD"


    rm -rf $TEMPDIR/*
    
    # Export xtdoc/sd
    echo "**** Exporting module $MODULE"
    cvs -d $REPOSITORY export -r $RELEASE -d $TEMPDIR $MODULE
    
    echo "he he `pwd`"
    
    mkdir $TEMPDOC
    # Export gt/doc
    echo "**** Exporting module $DOCMODULE"
    cvs -d $REPOSITORY export -r $RELEASE -d $TEMPDOC $DOCMODULE

    cd
    mv $TEMPDOC $MODULE/xdocs
}

pack_dir ()
{
    cd
  cd ~/toserver/documentation
  tar cf temp.tar *
}

move_archives()
{
  USERNAME="giella"
  IP_NUMBER="129.242.176.166"
  EXPORTDIR="/var/lib/tomcat5/webapps/divvun-no/project/src/documentation"

  scp ~/toserver/documentation/temp.tar $USERNAME@$IP_NUMBER:
  shh $USERNAME@$IP_NUMBER sudo -u tomcat5 tar xf temp.tar -C $EXPORTDIR
}

checkout