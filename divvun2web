#!/bin/bash
#
# $Id$
# Shell script for exporting divvun.no and giellaktekno www-pages from cvs 
# to the official www-directory
#
# To get cvs ssh working without password prompting:
# ssh-keygen -t rsa
# <just type enter to all questions>
# chmod 0644 .ssh/id_rsa.pub
# scp id_rsa.pub <user>@cochise.uit.no:.ssh/authorized_keys2


export CVS_RSH=ssh

checkout()
{
    # Module name what we want to publish
    REPOSITORY=":ext:cochise.uit.no:/usr/local/cvs/repository"
    TEMPDIR=$1
    echo "This is checkout" $TEMPDIR
    if  ! [ -d $TEMPDIR ]; then
         cvs -d $REPOSITORY co $TEMPDIR
    else
        cd $TEMPDIR
        cvs -z4 up -dP
    fi
}

fetch_giella_and_divvun()
{
    for cvs_dir in xtdoc gt
    do
        echo "This is cvs_dir $cvs_dir"
        checkout $cvs_dir
    done

    for site in gtuit sd
    do
        if ! [ -l xtdoc/$site/src/documentation/content/xdocs/doc ]
        then
            ln -s gt/doc xtdoc/$site/src/documentation/content/xdocs/doc
        fi
    done
}

validate_sites()
{
    for site in sd gtuit
    do
        cd xtdoc/$site
        #make a check out of this. If success, copy site, if not, mail problem to divvun@samediggi.no, preferably with a backtrace.
        if [ forrest validate-xdocs ]
        then
            cd src/
            if $site == sd
            then
                goal=divvun-no
            else
                goal=giellatekno
            fi
            sudo -u tomcat5 cp -a * /var/lib/tomcat5/webapps/$goal/project/src/
        else
            mail -a divvun@samediggi.no -s Could not validate site $site
        fi
    done
}

fetch_giella_and_divvun
#validate_sites