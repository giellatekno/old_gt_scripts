#!/bin/bash

#****************************************************************
#			fst2opt
#			written by Saara Huhmarniemi
#
#           Copy and compile the latest versions of the analyzer tools
#
# $Id$
#****************************************************************

tmpdir=/usr/tmp
host=$(hostname)

# Set variables according to the current host.
if [ "$host" == "hum-tf4-ans142.hum.uit.no" ]
then
	group=staff
	cd $tmpdir && cvs -d :ext:victorio.uit.no:/usr/local/cvs/repository checkout gt
	cd $tmpdir && cvs -d :ext:victorio.uit.no:/usr/local/cvs/repository checkout st
else
	PATH=$PATH:/opt/xerox/bin
	group=cvs
	cd $tmpdir && cvs -d /usr/local/cvs/repository checkout gt
	cd $tmpdir && cvs -d /usr/local/cvs/repository checkout st
fi

build_gt() {

	for lang in "sme" "smj" "sma"
	  do
	  cd $tmpdir/gt/ && make clean TARGET=$lang 
	  cd $tmpdir/gt/ && make TARGET=$lang 1>/dev/null
	  cd $tmpdir/gt/ && make TARGET=$lang hyph-$lang.fst 1>/dev/null
	  cd $tmpdir/gt/ && make TARGET=$lang ifst-norm 1>/dev/null
	  
	  cp $tmpdir/gt/$lang/bin/$lang.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/i$lang.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/i$lang-norm.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/hyph-$lang.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/$lang-dis.rle /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/abbr.txt /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/src/typos.txt /opt/smi/$lang/bin/
	  cp $tmpdir/gt/cwb/korpustags.$lang.txt /opt/smi/$lang/bin/

	  chgrp $group /opt/smi/$lang/bin/*
	  chmod a+x /opt/smi/$lang/bin/*
	  chmod g+w /opt/smi/$lang/bin/*
	done

	cp $tmpdir/gt/script/hyph-filter.pl /opt/smi/common/bin/
	cp $tmpdir/gt/cwb/korpustags.txt /opt/smi/common/bin/
	cp $tmpdir/gt/cwb/paradigm.txt /opt/smi/common/bin/
	cp $tmpdir/gt/common/bin/allcaps.fst /opt/smi/common/bin/
	
	chgrp $group /opt/smi/common/bin/*
	chmod a+x /opt/smi/common/bin/*
	chmod g+w /opt/smi/common/bin/*
	
}


# st-catalog
build_st() {

	for lang in "foe" "kal"
	  do
        cd $tmpdir/st/$lang/src && make clean
        cd $tmpdir/st/$lang/src && make 1>/dev/null
		
        cp $tmpdir/st/$lang/bin/$lang.fst /opt/smi/$lang/bin/
        cp $tmpdir/st/$lang/bin/i$lang.fst /opt/smi/$lang/bin/
        cp $tmpdir/st/$lang/bin/hyph-$lang.fst /opt/smi/$lang/bin/
        cp $tmpdir/st/$lang/src/$lang-dis.rle /opt/smi/$lang/bin/
#       cp $tmpdir/st/$lang/bin/abbr.txt /opt/smi/$lang/bin/
		
        chgrp cvs /opt/smi/$lang/bin/*
        chmod a+x /opt/smi/$lang/bin/*
        chmod g+w /opt/smi/$lang/bin/*
	done
}


# Call subroutines for building gt- and st-hierarchies.
build_gt

if [ "$host" != "hum-tf4-ans142.hum.uit.no" ]
then
	build_st
else
	cd $tmpdir/st/nob/src && make abbr 
	cp $tmpdir/st/nob/bin/abbr.txt /opt/smi/nob/bin/
fi
