#!/bin/bash

#****************************************************************
#			fst2opt
#			written by Saara Huhmarniemi
#
#           Copy and compile the latest versions of the analyzer tools
#
# $Id$
#****************************************************************

host=$(hostname)

commonbin="/opt/smi/common/bin"
tmpdir=/usr/tmp

if [ ! -d $tmpdir ]
    then
    tmpdir=/tmp
fi

scripts=$tmpdir/gt/script

copy() {

    if [ "$host" == "hum-stud113.hum.uit.no" ]
	then
		cd $tmpdir && cvs -d :ext:victorio.uit.no:/usr/local/cvs/repository checkout gt
		cd $tmpdir && cvs -d :ext:victorio.uit.no:/usr/local/cvs/repository checkout st
    else	
		cd $tmpdir && cvs -d /usr/local/cvs/repository checkout gt
		cd $tmpdir && cvs -d /usr/local/cvs/repository checkout st
    fi
}

build_gt() {

    if [ -z "$@" ]
	then
	langs="sme smj sma"
    else
	langs="$@"
    fi

    echo LANGUAGES $langs
    for lang in $langs
	  do
	  #cd $tmpdir/gt/ && make clean TARGET=$lang 
	  cd $tmpdir/gt/ && make TARGET=$lang 1>/dev/null
	  cd $tmpdir/gt/ && make TARGET=$lang hyph-$lang.fst 1>/dev/null
	  cd $tmpdir/gt/ && make TARGET=$lang ifst-norm 1>/dev/null
	  cd $tmpdir/gt/ && make TARGET=$lang hi-norm 1>/dev/null
	  
	  cp $tmpdir/gt/$lang/bin/$lang.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/i$lang.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/i$lang-norm.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/hi$lang-norm.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/hyph-$lang.fst /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/src/$lang-dis.rle /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/bin/abbr.txt /opt/smi/$lang/bin/
	  cp $tmpdir/gt/$lang/src/typos.txt /opt/smi/$lang/bin/
	  cp $tmpdir/gt/cwb/korpustags.$lang.txt /opt/smi/$lang/bin
	  cp $tmpdir/gt/cwb/paradigm.$lang.txt /opt/smi/$lang/bin/

	  chgrp $group /opt/smi/$lang/bin/*
	  chmod a+x /opt/smi/$lang/bin/*
	  chmod g+w /opt/smi/$lang/bin/*
	done

	cp $scripts/hyph-filter.pl $commonbin
	cp $tmpdir/gt/cwb/korpustags.txt $commonbin
	cp $tmpdir/gt/cwb/paradigm.txt $commonbin
	cp $tmpdir/gt/cwb/paradigm_min.txt $commonbin
	cp $tmpdir/gt/cwb/paradigm_standard.txt $commonbin
	cp $tmpdir/gt/cwb/paradigm_full.txt $commonbin
	cp $tmpdir/gt/common/bin/allcaps.fst $commonbin

	anchor_list sme nno
	anchor_list sme smj
	
	chgrp $group $commonbin/*
	chmod a+x $commonbin/*
	chmod g+w $commonbin/*
	
}


# st-catalog
build_st() {

	if [ "$host" != "hum-tf4-ans142.hum.uit.no" ]
		then
		for lang in "foe" "kal"
		  do
		  cd $tmpdir/st/$lang/src && make clean
		  cd $tmpdir/st/$lang/src && make 1>/dev/null
		  
		  cp $tmpdir/st/$lang/bin/$lang.fst /opt/smi/$lang/bin/
		  cp $tmpdir/st/$lang/bin/i$lang.fst /opt/smi/$lang/bin/
		  cp $tmpdir/st/$lang/bin/hyph-$lang.fst /opt/smi/$lang/bin/
		  cp $tmpdir/st/$lang/src/$lang-dis.rle /opt/smi/$lang/bin/
#       cp $tmpdir/st/$lang/bin/abbr.txt /opt/smi/$lang/bin/
		  
		  chgrp cvs /opt/smi/$lang/bin/*
		  chmod a+x /opt/smi/$lang/bin/*
		  chmod g+w /opt/smi/$lang/bin/*
		done
	else
		cd $tmpdir/st/nob/src && make abbr 
		cp $tmpdir/st/nob/bin/abbr.txt /opt/smi/nob/bin/
	fi
	
}

# Generate the anchor word list for smenno
anchor_list() {

	if [ -z "$1" -o -z "$2" ]
		then
		echo "Usage: $0 anchor_list lang1 lang2"
		exit 1
	fi
	
	$scripts/generate-anchor-list.pl --lang1=$1 --lang2=$2 --outdir=$commonbin $tmpdir/gt/common/src/anchor.txt

}


case "$1" in
	build_gt)

        $@
        ;;
   build_st)
        $@
        ;;
   anchor_list)
        $@
        ;;
   copy)
        $@
        ;;
   *)
        echo $"Usage: $0 {build_gt langs | build_st | anchor_list lang1 lang2 | copy }"
        exit 1
        ;;
esac

exit 0
